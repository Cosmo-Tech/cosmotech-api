openapi: 3.0.3

info:
  title: Cosmo Tech Connector Manager API
  description: Cosmo Tech Connector Manager API
  version: 1.0.0

servers:
- url: 'http://localhost:8080'

security:
- ApiKeyAuth: [ ]
- AADOAuth2AuthCode: [ ]

tags:
- name: connector
  description: Connector Management

paths:
  /connectors:
    post:
      operationId: registerConnector
      tags:
        - connector
      summary: Register a new connector
      requestBody:
        description: the Connector to register
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Connector'
            examples:
              ADTNew:
                $ref: '#/components/examples/ADTConnectorNew'
      responses:
        "201":
          description: the connector details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Connector'
              examples:
                ADTConnector:
                  $ref: '#/components/examples/ADTConnector'
        "400":
          description: Bad request
    get:
      operationId: findAllConnectors
      tags:
        - connector
      summary: List all Connectors
      responses:
        "200":
          description: the connector details
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Connector'
              examples:
                OneConnector:
                  $ref: '#/components/examples/OneConnector'

  /connectors/upload:
    post:
      operationId: uploadConnector
      tags:
        - connector
      summary: Upload and register a new connector
      requestBody:
        description: the Connector to upload and register
        required: true
        content:
          application/yaml:
            schema:
              type: string
              format: binary
            examples:
              ADTConnector:
                $ref: '#/components/examples/ADTConnector'
      responses:
        "201":
          description: the connector details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Connector'
              examples:
                ADTConnector:
                  $ref: '#/components/examples/ADTConnector'
        "400":
          description: Bad request

  /connectors/{connector_id}:
    parameters:
      - name: connector_id
        in: path
        description: the Connector identifier
        required: true
        schema:
          type: string
    get:
      operationId: findConnectorById
      tags:
        - connector
      summary: Get the details of an connector
      responses:
        "200":
          description: the Connector details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Connector'
              examples:
                ADTConnector:
                  $ref: '#/components/examples/ADTConnector'
        "404":
          description: the Connector specified is unknown or you don't have access to it
    patch:
      operationId: updateConnector
      tags:
        - connector
      summary: Update an connector
      requestBody:
        description: the new Connector details
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Connector'
            examples:
              ChangeName:
                summary: Change Name of Connector
                description: Change the name of Connector ADT Connector
                value:
                  name: "New ADT Connector"
      responses:
        "200":
          description: the connector details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Connector'
              examples:
                ADTConnector:
                  $ref: '#/components/examples/ADTConnectorRenamed'
        "400":
          description: Bad request
        "404":
          description: the Connector specified is unknown or you don't have access to it
    delete:
      operationId: unregisterConnector
      tags:
        - connector
      summary: Unregister an connector
      responses:
        "200":
          description: the connector details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Connector'
              examples:
                ADTConnector:
                  $ref: '#/components/examples/ADTConnector'
        "400":
          description: Bad request
        "404":
          description: the Connector specified is unknown or you don't have access to it

components:
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      description: The Cosmo Tech API Key
      name: key
      in: query
    AADOAuth2AuthCode:
      type: oauth2
      description: Azure Active Directory authentication
      flows:
        implicit:
          authorizationUrl: https://login.microsoftonline.com/e9641c78-d0d6-4d09-af63-168922724e7f/oauth2/v2.0/authorize
          scopes:
            http://sample.azure.cosmo-platform.com/user_impersonation: User Impersonation
  schemas:
    Connector:
      type: object
      description: a Connector
      properties:
        id:
          type: string
          description: the Connector unique identifier, in response
        name:
          type: string
          description: the Connector name
        description:
          type: string
          description: the Connector description
        repository:
          type: string
          description: the registry repository containing the image
        version:
          type: string
          description: the Connector version. Must be aligned with an existing repository tag
        url:
          type: string
          description: an optional URL link to connector page
        readEnabled:
          type: boolean
          description: whether or not the connector can read data
        writeEnabled:
          type: boolean
          description: wheher or not the connector can write data
        parameterGroups:
          type: array
          description: the list of connector parameters groups
          items:
            $ref: '#/components/schemas/ConnectorParameterGroup'
    ConnectorParameterGroup:
      type: object
      description: a connector parameters group
      properties:
        id:
          type: string
          description: the connector parameter group id
        label:
          type: string
          description: the list of translated parameter group labels
        parameters:
          type: array
          description: the list of parameters
          items:
            $ref: '#/components/schemas/ConnectorParameter'
    ConnectorParameter:
      type: object
      description: a connector parameter
      properties:
        id:
          type: string
          description: the connector parameter id
        label:
          type: string
          description: the list of translated parameter group labels
        valueType:
          type: string
          description: the parameter value type
        options:
          type: array
          description: the list of available and valid values for the parameter
          items:
            type: string
        default:
          type: string
          description: the default value
        envVar:
          type: string
          description: associated environment variable in connector image
  examples:
    ADTConnectorNew:
      summary: New ADT Connector
      description: ADT Connector new registration input example
      value:
        name: "ADT Connector"
        description: "Connector for Azure Digital Twins. Read ADT and write the data in CSV for the Simulation"
        repository: "azure-digital-twins-simulator-connector"
        version: "1.0"
        url: "https://github.com/Cosmo-Tech/azure-digital-twins-simulator-connector"
        readEnabled: true
        writeEnabled: false
        parameterGroups:
          - id: "security"
            label: "Security"
            parameters:
              - id: "AZURE_TENANT_ID"
                label: "Azure Tenant Id"
                valueType: "string"
                envVar: "AZURE_TENANT_ID"
              - id: "AZURE_CLIENT_ID"
                label: "Azure Client Id"
                valueType: "string"
                envVar: "AZURE_CLIENT_ID"
              - id: "AZURE_CLIENT_SECRET"
                label: "Azure CLient secret"
                valueType: "password"
                envVar: "AZURE_CLIENT_SECRET"
          - id: "parameters"
            label: "Parameters"
            parameters:
              - id: "AZURE_DIGITAL_TWINS_URL"
                label: "Azure Digital Twins URL"
                valueType: "string"
                envVar: "AZURE_DIGITAL_TWINS_URL"
              - id: "ADT_QUERY"
                label: "Azure Digital Twins query"
                valueType: "string"
                envVar: "AZURE_DIGITAL_TWINS_QUERY"
                default: "SELECT * FROM digitaltwins"
              - id: "EXPORT_CSV_FILE_ABSOLUTE_PATH"
                label: "CSV file export absolute path"
                valueType: "string"
                default: "/mnt/simulation-data"
                envVar: "EXPORT_CSV_FILE_ABSOLUTE_PATH"
    ADTConnector:
      summary: ADT Connector
      description: ADT Connector example
      value:
        id: "1"
        name: "ADT Connector"
        description: "Connector for Azure Digital Twins. Read ADT and write the data in CSV for the Simulation"
        repository: "azure-digital-twins-simulator-connector"
        version: "1.0"
        url: "https://github.com/Cosmo-Tech/azure-digital-twins-simulator-connector"
        readEnabled: true
        writeEnabled: false
        parameterGroups:
          - id: "security"
            label: "Security"
            parameters:
              - id: "AZURE_TENANT_ID"
                label: "Azure Tenant Id"
                valueType: "string"
                envVar: "AZURE_TENANT_ID"
              - id: "AZURE_CLIENT_ID"
                label: "Azure Client Id"
                valueType: "string"
                envVar: "AZURE_CLIENT_ID"
              - id: "AZURE_CLIENT_SECRET"
                label: "Azure CLient secret"
                valueType: "password"
                envVar: "AZURE_CLIENT_SECRET"
          - id: "parameters"
            label: "Parameters"
            parameters:
              - id: "AZURE_DIGITAL_TWINS_URL"
                label: "Azure Digital Twins URL"
                valueType: "string"
                envVar: "AZURE_DIGITAL_TWINS_URL"
              - id: "ADT_QUERY"
                label: "Azure Digital Twins query"
                valueType: "string"
                envVar: "AZURE_DIGITAL_TWINS_QUERY"
                default: "SELECT * FROM digitaltwins"
              - id: "EXPORT_CSV_FILE_ABSOLUTE_PATH"
                label: "CSV file export absolute path"
                valueType: "string"
                default: "/mnt/simulation-data"
                envVar: "EXPORT_CSV_FILE_ABSOLUTE_PATH"
    ADTConnectorRenamed:
      summary: ADT Connector
      description: ADT Connector example
      value:
        id: "1"
        name: "New ADT Connector"
        description: "Connector for Azure Digital Twins. Read ADT and write the data in CSV for the Simulation"
        repository: "azure-digital-twins-simulator-connector"
        version: "1.0"
        url: "https://github.com/Cosmo-Tech/azure-digital-twins-simulator-connector"
        readEnabled: true
        writeEnabled: false
        parameterGroups:
          - id: "security"
            label: "Security"
            parameters:
              - id: "AZURE_TENANT_ID"
                label: "Azure Tenant Id"
                valueType: "string"
                envVar: "AZURE_TENANT_ID"
              - id: "AZURE_CLIENT_ID"
                label: "Azure Client Id"
                valueType: "string"
                envVar: "AZURE_CLIENT_ID"
              - id: "AZURE_CLIENT_SECRET"
                label: "Azure CLient secret"
                valueType: "password"
                envVar: "AZURE_CLIENT_SECRET"
          - id: "parameters"
            label: "Parameters"
            parameters:
              - id: "AZURE_DIGITAL_TWINS_URL"
                label: "Azure Digital Twins URL"
                valueType: "string"
                envVar: "AZURE_DIGITAL_TWINS_URL"
              - id: "ADT_QUERY"
                label: "Azure Digital Twins query"
                valueType: "string"
                envVar: "AZURE_DIGITAL_TWINS_QUERY"
                default: "SELECT * FROM digitaltwins"
              - id: "EXPORT_CSV_FILE_ABSOLUTE_PATH"
                label: "CSV file export absolute path"
                valueType: "string"
                default: "/mnt/simulation-data"
                envVar: "EXPORT_CSV_FILE_ABSOLUTE_PATH"
    OneConnector:
      summary: One Connector list
      description: One Connector list example
      value:
        - id: "1"
          name: "ADT Connector"
          description: "Connector for Azure Digital Twins. Read ADT and write the data in CSV for the Simulation"
          repository: "azure-digital-twins-simulator-connector"
          version: "1.0"
          url: "https://github.com/Cosmo-Tech/azure-digital-twins-simulator-connector"
          readEnabled: true
          writeEnabled: false
          parameterGroups:
            - id: "security"
              label: "Security"
              parameters:
                - id: "AZURE_TENANT_ID"
                  label: "Azure Tenant Id"
                  valueType: "string"
                  envVar: "AZURE_TENANT_ID"
                - id: "AZURE_CLIENT_ID"
                  label: "Azure Client Id"
                  valueType: "string"
                  envVar: "AZURE_CLIENT_ID"
                - id: "AZURE_CLIENT_SECRET"
                  label: "Azure CLient secret"
                  valueType: "password"
                  envVar: "AZURE_CLIENT_SECRET"
            - id: "parameters"
              label: "Parameters"
              parameters:
                - id: "AZURE_DIGITAL_TWINS_URL"
                  label: "Azure Digital Twins URL"
                  valueType: "string"
                  envVar: "AZURE_DIGITAL_TWINS_URL"
                - id: "ADT_QUERY"
                  label: "Azure Digital Twins query"
                  valueType: "string"
                  envVar: "AZURE_DIGITAL_TWINS_QUERY"
                  default: "SELECT * FROM digitaltwins"
                - id: "EXPORT_CSV_FILE_ABSOLUTE_PATH"
                  label: "CSV file export absolute path"
                  valueType: "string"
                  default: "/mnt/simulation-data"
                  envVar: "EXPORT_CSV_FILE_ABSOLUTE_PATH"
